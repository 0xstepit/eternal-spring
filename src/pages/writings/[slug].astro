---
import Base from "../../layouts/Base.astro";

import type { GetStaticPaths } from "astro";

import { toPostDate, getDay, getMonth, getYear } from "../../scripts/dates";
import type { CollectionEntry } from "astro:content";
import { getCollection, render } from "astro:content";
import { getNeighbors } from "@/scripts/posts";
import NextPrevWritings from "@/components/NextPrevWritings.astro";

export const getStaticPaths: GetStaticPaths = async () => {
  const posts = await getCollection("writings", ({ data }) => {
    return data["to-publish"] === true;
  });

  console.log(`Total blog posts: ${posts.length}`);

  return posts.map((post) => {
    console.log(`Post ID: ${post.id}`);

    return {
      params: { slug: post.id },
      props: { post },
    };
  });
};

interface Props {
  post: CollectionEntry<"writings">;
}

const { post } = Astro.props;
// const { Content, headings, remarkPluginFrontmatter } = await render(post);
const { Content } = await render(post);

const postDate = post.data.date;
const day = getDay(postDate);
const month = getMonth(postDate).toLocaleLowerCase();
const year = getYear(postDate);
const formattedDate = toPostDate(postDate);

// Get neighbor writings

const n = await getNeighbors(post.id);
---

<!-- <Base pageTitle={post.id} pageStyle={"dotted"}> -->
<Base pageTitle={post.id} pageStyle={""}>
  <article class="article">
    <header class="article-header">
      <h1>{post.data.title}</h1>

      {
        post.data.tags.length > 0 && (
          <ul class="post-tags">
            {post.data.tags.map((tag: string) => (
              <li>{tag}</li>
            ))}
          </ul>
        )
      }

      <p class="article-meta">
        <span>Published by</span>
        <span class="article-author">{post.data.author}</span>
        <span>on</span>
        <!-- {headings.map((h) => <div>{h.slug}</div>)} -->
        <span class="article-meta-date">
          <a href={`https://www.onthisday.com/date/${year}/${month}/${day}`}
            ><time>{formattedDate}</time></a
          ></span
        >
      </p>

      <p class="article-summary">{post.data.summary}</p>
    </header>

    <div class="decorator">
      <span>~</span>
      <span>~</span>
      <span>~</span>
    </div>

    <div class="article-content">
      <Content />
    </div>

    <div class="article-neighbor">
      <NextPrevWritings neighbors={n} />
    </div>
  </article>
</Base>
